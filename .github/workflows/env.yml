name: Run Azure Login With a Service Principal Secret

on: [push]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # Paso para el checkout del c贸digo
      - name: Checkout code
        uses: actions/checkout@v3

      # Paso para mostrar los secretos del entorno (solo para depuraci贸n, eliminar en producci贸n)
      - name: Show secrets
        run: |
          echo "AZURE_CREDENTIALS=${{ secrets.AZURE_CREDENTIALS }}"

      # Paso para iniciar sesi贸n en Azure
      - name: Azure Login
        id: azure_login
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
        continue-on-error: true

      # Paso para mostrar el estado del login de Azure CLI
      - name: Verify Azure Login Status
        run: |
          az account list --output table
        continue-on-error: true

      # Paso para ejecutar un script de Azure CLI
      - name: Azure CLI script
        id: azure_cli_script
        uses: azure/cli@v2
        with:
          azcliversion: latest
          inlineScript: |
            az account show
        continue-on-error: true

      # Paso para depurar los logs del workflow
      - name: Debug Logs
        run: |
          echo "Azure Login Status:"
          az account list --output table || echo "Error: Failed to list Azure accounts."
          
          echo "Azure CLI Version:"
          az --version || echo "Error: Failed to retrieve Azure CLI version."
          
          echo "Environment Variables:"
          env || echo "Error: Failed to retrieve environment variables."
